<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Hải Phòng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600&display=swap');

        body {
            font-family: 'Quicksand', sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #e0f7fa;
            color: #333;
            overflow: auto;
        }

        /* Thêm style cho header chứa logo */
        .header {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            background-color: #ffffff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .logo {
            height: 50px;
            margin-right: 15px;
        }

        .city-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #005baa;
        }

        /* Thêm style cho footer */
        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #ffffff;
            border-top: 1px solid #e0e0e0;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            font-size: 0.9em;
        }

        .footer-logo {
            height: 40px;
        }

        .footer-content {
            flex-grow: 1;
            text-align: center;
            font-weight: bold;
        }

        /* Thêm style cho logo lớn ở trang chủ */
        .homepage-main-logo {
            height: 150px;
            margin-bottom: 20px;
        }
        
        #home-menu {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            flex-grow: 1;
            padding: 20px;
            text-align: center;
            background-color: #ffffff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            margin: 20px;
        }

        #home-menu h1 {
            color: #005baa;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .topic-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            width: 80%;
            max-width: 900px;
        }

        .topic-button {
            background-color: #005baa;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 20px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .topic-button i {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .topic-button:hover {
            background-color: #004080;
            transform: translateY(-3px);
        }

        #chatbot-container {
            display: none;
            flex-grow: 1;
            flex-direction: row;
            overflow: hidden;
            background-color: #ffffff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            margin: 20px;
        }

        #sidebar {
            width: 200px;
            background-color: #e3f2fd;
            padding: 15px;
            border-right: 1px solid #bbdefb;
            display: flex;
            flex-direction: column;
            box-shadow: inset -2px 0 5px rgba(0,0,0,0.05);
        }

        #sidebar h3 {
            color: #005baa;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
        }

        .sidebar-button {
            background-color: #bbdefb;
            color: #333;
            border: none;
            border-radius: 8px;
            padding: 12px 10px;
            margin-bottom: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            text-align: left;
            display: flex;
            align-items: center;
        }

        .sidebar-button i {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .sidebar-button.active, .sidebar-button:hover {
            background-color: #64b5f6;
            color: white;
            transform: translateX(3px);
        }

        .chat-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #khung-tro-chuyen {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            border-bottom: 1px solid #b2ebf2;
            background-color: #ffffff;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }

        .tin-nhan {
            margin-bottom: 10px;
            padding: 10px 15px;
            border-radius: 20px;
            max-width: 75%;
            position: relative;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .tin-nhan-nguoi-dung {
            background-color: #007bff;
            color: white;
            margin-left: auto;
            text-align: right;
            border-bottom-right-radius: 5px;
        }

        .tin-nhan-bot {
            background-color: #e3f2fd;
            color: #212121;
            margin-right: auto;
            text-align: left;
            border-bottom-left-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        #khu-vuc-nhap {
            display: flex;
            padding: 15px;
            background-color: #ffffff;
            border-top: 1px solid #e0e0e0;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.05);
            align-items: center;
        }

        #o-nhap-tin-nhan {
            flex-grow: 1;
            padding: 12px 18px;
            border: 1px solid #bbdefb;
            border-radius: 25px;
            outline: none;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        #o-nhap-tin-nhan:focus {
            border-color: #64b5f6;
            box-shadow: 0 0 0 3px rgba(100, 181, 246, 0.2);
        }

        #nut-gui {
            background-color: #005baa;
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            margin-left: 15px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease;
        }

        #nut-gui:hover {
            background-color: #004080;
        }

        #nut-gui:active {
            transform: translateY(1px);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                padding: 10px;
            }
            
            .logo-container {
                margin-bottom: 10px;
            }
            
            .footer {
                flex-direction: column;
                text-align: center;
                padding: 10px;
            }
            
            .footer-logo {
                margin-bottom: 10px;
            }
            
            #home-menu {
                margin: 10px;
                padding: 15px;
            }

            #home-menu h1 {
                font-size: 1.8em;
                margin-bottom: 20px;
            }

            .topic-buttons {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 15px;
                width: 95%;
            }

            .topic-button {
                padding: 15px;
                font-size: 1em;
            }

            .topic-button i {
                font-size: 2em;
                margin-bottom: 8px;
            }

            #chatbot-container {
                flex-direction: column;
                margin: 10px;
                border-radius: 8px;
            }

            #sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #bbdefb;
                padding: 10px;
                box-shadow: inset 0 -2px 5px rgba(0,0,0,0.05);
                flex-direction: row;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }

            #sidebar h3 {
                display: none;
            }

            .sidebar-button {
                flex-shrink: 0;
                width: auto;
                margin-bottom: 0;
                margin-right: 10px;
                padding: 8px 12px;
                font-size: 0.9em;
            }

            .sidebar-button i {
                font-size: 1em;
                margin-right: 5px;
            }

            .chat-area {
                min-height: 0;
            }

            #khung-tro-chuyen {
                padding: 10px;
            }

            .tin-nhan {
                max-width: 85%;
                padding: 8px 12px;
                font-size: 0.9em;
            }

            #khu-vuc-nhap {
                padding: 10px;
            }

            #o-nhap-tin-nhan {
                padding: 10px 15px;
                font-size: 14px;
            }

            #nut-gui {
                width: 40px;
                height: 40px;
                font-size: 20px;
                margin-left: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-container">
           
            <div class="city-name">Thành phố Hải Phòng</div>
        </div>
    </div>

    <div id="home-menu">
       
        <h1>Chatbot Hải Phòng</h1>
        <div class="topic-buttons">
            <button class="topic-button" data-topic="lich-su">
                <i class="fas fa-landmark"></i>
                Lịch sử
            </button>
            <button class="topic-button" data-topic="du-lich">
                <i class="fas fa-map-marked-alt"></i>
                Du lịch
            </button>
            <button class="topic-button" data-topic="am-thuc">
                <i class="fas fa-utensils"></i>
                Ẩm thực
            </button>
            <button class="topic-button" data-topic="van-hoa">
                <i class="fas fa-theater-masks"></i>
                Văn hóa
            </button>
            <button class="topic-button" data-topic="kinh-te">
                <i class="fas fa-chart-line"></i>
                Kinh tế
            </button>
            <button class="topic-button" data-topic="giao-thong">
                <i class="fas fa-bus"></i>
                Giao thông
            </button>
        </div>
    </div>

    <div id="chatbot-container">
        <div id="sidebar">
            <h3>Chủ đề</h3>
            <button class="sidebar-button" data-topic="lich-su">
                <i class="fas fa-landmark"></i>
                Lịch sử
            </button>
            <button class="sidebar-button" data-topic="du-lich">
                <i class="fas fa-map-marked-alt"></i>
                Du lịch
            </button>
            <button class="sidebar-button" data-topic="am-thuc">
                <i class="fas fa-utensils"></i>
                Ẩm thực
            </button>
            <button class="sidebar-button" data-topic="van-hoa">
                <i class="fas fa-theater-masks"></i>
                Văn hóa
            </button>
            <button class="sidebar-button" data-topic="kinh-te">
                <i class="fas fa-chart-line"></i>
                Kinh tế
            </button>
            <button class="sidebar-button" data-topic="giao-thong">
                <i class="fas fa-bus"></i>
                Giao thông
            </button>
        </div>
        <div class="chat-area">
            <div id="khung-tro-chuyen">
            </div>
            <div id="khu-vuc-nhap">
                <input type="text" id="o-nhap-tin-nhan" placeholder="Hỏi về Hải Phòng...">
                <button id="nut-gui">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <div class="footer-content">
            @Copyright - Chatbot Hải Phòng
        </div>
        <div></div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "@google/generative-ai": "https://esm.run/@google/generative-ai"
            }
        }
    </script>
    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // Thay thế "YOUR_API_KEY" bằng khóa API thực tế của bạn
        const KHOA_API = "AIzaSyA7cQu6kAKt1b5D2Z88DkIVFdOL7LCUwuc"; 
        const moHinhAI = new GoogleGenerativeAI(KHOA_API);
        const moHinh = moHinhAI.getGenerativeModel({ model: "gemini-2.0-flash-thinking-exp-01-21" });

        const homeMenu = document.getElementById('home-menu');
        const chatbotContainer = document.getElementById('chatbot-container');
        const khungTroChuyen = document.getElementById('khung-tro-chuyen');
        const oNhapTinNhan = document.getElementById('o-nhap-tin-nhan');
        const nutGui = document.getElementById('nut-gui');
        const topicButtons = document.querySelectorAll('.topic-button');
        const sidebarButtons = document.querySelectorAll('.sidebar-button');

        let currentTopic = '';
        
        // Định nghĩa các chủ đề về Hải Phòng
        const topicInfo = {
            "lich-su": {
                name: "Lịch sử Hải Phòng",
                description: "Lịch sử hình thành và phát triển của thành phố Hải Phòng",
                keywords: ["lịch sử", "thành lập", "phát triển", "cảng", "chiến tranh", "tiểu sử", "sự kiện"]
            },
            "du-lich": {
                name: "Du lịch Hải Phòng",
                description: "Các địa điểm du lịch nổi tiếng tại Hải Phòng",
                keywords: ["du lịch", "địa điểm", "thắng cảnh", "cát bà", "đồ sơn", "thăm quan", "di tích"]
            },
            "am-thuc": {
                name: "Ẩm thực Hải Phòng",
                description: "Đặc sản và ẩm thực đặc trưng của Hải Phòng",
                keywords: ["ẩm thực", "đặc sản", "món ăn", "bánh đa cua", "bánh mì cay", "hải sản", "quán ăn"]
            },
            "van-hoa": {
                name: "Văn hóa Hải Phòng",
                description: "Văn hóa và con người Hải Phòng",
                keywords: ["văn hóa", "con người", "lễ hội", "truyền thống", "phong tục", "nghệ thuật", "di sản"]
            },
            "kinh-te": {
                name: "Kinh tế Hải Phòng",
                description: "Tình hình kinh tế và các ngành công nghiệp chính của Hải Phòng",
                keywords: ["kinh tế", "công nghiệp", "cảng biển", "xuất nhập khẩu", "đầu tư", "doanh nghiệp", "phát triển"]
            },
            "giao-thong": {
                name: "Giao thông Hải Phòng",
                description: "Hệ thống giao thông và phương tiện đi lại tại Hải Phòng",
                keywords: ["giao thông", "đường xá", "cầu", "bến xe", "sân bay", "cảng", "phương tiện"]
            }
        };

        // Hàm thêm tin nhắn vào giao diện
        function themTinNhanVaoGiaoDien(nguoiGui, vanBan) {
            const divTinNhan = document.createElement('div');
            divTinNhan.classList.add('tin-nhan', `tin-nhan-${nguoiGui}`);
            divTinNhan.innerHTML = vanBan.replace(/\n/g, '<br>');
            khungTroChuyen.appendChild(divTinNhan);
            khungTroChuyen.scrollTop = khungTroChuyen.scrollHeight;
        }

        // Chọn chủ đề
        function selectTopic(topic) {
            currentTopic = topic;
            homeMenu.style.display = 'none';
            chatbotContainer.style.display = 'flex';
            khungTroChuyen.innerHTML = '';
            
            themTinNhanVaoGiaoDien("bot", 
                `Xin chào! Tôi là chatbot chuyên cung cấp thông tin về Hải Phòng. ` +
                `Hiện tại bạn đang tìm hiểu về chủ đề <strong>${topicInfo[topic].name}</strong>. ` +
                `Hãy hỏi tôi bất cứ điều gì về ${topicInfo[topic].description} nhé!`);

            // Cập nhật active state cho sidebar
            sidebarButtons.forEach(button => {
                button.classList.toggle('active', button.dataset.topic === topic);
            });
        }

        // Gắn sự kiện khi trang tải xong
        document.addEventListener('DOMContentLoaded', () => {
            // Gắn sự kiện cho các nút chủ đề
            topicButtons.forEach(button => {
                button.addEventListener('click', () => selectTopic(button.dataset.topic));
            });
            
            sidebarButtons.forEach(button => {
                button.addEventListener('click', () => selectTopic(button.dataset.topic));
            });
            
            // Gắn sự kiện gửi tin nhắn
            nutGui.addEventListener('click', guiTinNhan);
            oNhapTinNhan.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') guiTinNhan();
            });
        });

        // Gửi tin nhắn
        async function guiTinNhan() {
            const tinNhanNguoiDung = oNhapTinNhan.value.trim();
            if (!tinNhanNguoiDung) return;

            themTinNhanVaoGiaoDien("nguoi-dung", tinNhanNguoiDung);
            oNhapTinNhan.value = '';

            // Xử lý lời chào
            if (["chào", "hello", "hi", "xin chào"].some(word => tinNhanNguoiDung.toLowerCase().includes(word))) {
                if (currentTopic) {
                    themTinNhanVaoGiaoDien("bot", `Xin chào! Tôi là chatbot chuyên cung cấp thông tin về Hải Phòng. Bạn đang tìm hiểu về ${topicInfo[currentTopic].name}. Hãy hỏi tôi bất cứ điều gì về chủ đề này nhé!`);
                } else {
                    themTinNhanVaoGiaoDien("bot", "Xin chào! Tôi là chatbot chuyên cung cấp thông tin về Hải Phòng. Hãy chọn một chủ đề từ menu để bắt đầu!");
                }
                return;
            }

            // Xử lý các câu hỏi thông thường
            try {
                let loiNhac = `Bạn là một chatbot chuyên cung cấp thông tin về thành phố Hải Phòng, Việt Nam. Hãy nhớ rằng Thành phố Hải Phòng và Hải Dương đã sáp nhập và tên là Thành Phố Hải Phòng.`;
                
                if (currentTopic && topicInfo[currentTopic]) {
                    loiNhac += `Hiện tại người dùng đang tìm hiểu về chủ đề: ${topicInfo[currentTopic].name} - ${topicInfo[currentTopic].description}. `;
                    loiNhac += `Hãy trả lời câu hỏi tập trung vào chủ đề này. `;
                }
                
                loiNhac += `Hãy trả lời ngắn gọn, chính xác và thân thiện. `;
                loiNhac += `Nếu câu hỏi không liên quan đến Hải Phòng, hãy nhẹ nhàng hướng người dùng quay lại chủ đề.`;
                loiNhac += `\n\nCâu hỏi: ${tinNhanNguoiDung}`;

                const ketQua = await moHinh.generateContent(loiNhac);
                const phanHoi = await ketQua.response;
                const traLoiBot = phanHoi.text();
                themTinNhanVaoGiaoDien("bot", traLoiBot);

            } catch (loi) {
                console.error("Lỗi khi gọi API Gemini: ", loi);
                themTinNhanVaoGiaoDien("bot", "Rất tiếc, có lỗi xảy ra. Bạn vui lòng thử lại sau nhé!");
            }
        }
    </script>
</body>
</html>
